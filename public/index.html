<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" type="text/css" href="basic.css" />
        <link rel="stylesheet" type="text/css" href="style.css" />
        <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="http://coffeescript.org/extras/coffee-script.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        
        <script type="text/coffeescript">
            
            #local f12:06 s12:45 
            
            #s5568-f8069 s10570
            #s11:53-f12:19:45 12:54:45-12:59:58
            
            $ ->

                socket = io.connect document.domain

                socket.on 'client.users.total', (count) ->
                    $('span.users').html count
                    
                socket.on 'client.queue.total', (count) ->
                    $('span.queue').html count
                    
                socket.on 'client.queue.newentry', (count) ->
                    $('span.newentry').html count
                    
                socket.on 'client.rate.limit', (rate) ->
                
                    if rate?.message
                        $('span.limit').html rate.message
                        $('span.remaining').html ''
                        
                    else if rate?.rate
                        $('span.limit').html rate.rate.limit
                        $('span.remaining').html rate.rate.remaining
                        
                socket.on 'client.user.search', (users) ->

                    console.log users
                    if users?
                    
                        for user in users
                        
                            li = $('<li>').html user
                            $('ul#userlist').append li
  
                
#                socket.on 'client.users.search', (users) ->
#                    console.log users
#                    
#                socket.emit 'server.user.search', 'ghost'
#                
#                socket.emit 'server.users.add', 'symfony'


                $('a.newuser').click (event) ->
                
                    event.preventDefault()
                
                    username = $('input#newuser').val()
                    
                    if username != ''
                        socket.emit 'server.users.add', username
                    
                
                $('input#finduser').keyup (event) ->
                
                    event.preventDefault()
                
                    $('ul#userlist').empty()
                    username = $('input#finduser').val()
                    
                    if username != ''
                        socket.emit 'server.user.search', username
                    
                
                update = () ->
                    socket.emit 'server.users.total'
                    socket.emit 'server.queue.total'
                    socket.emit 'server.rate.limit'
                    socket.emit 'server.queue.newentry'
                    
                update()
                
                setInterval update, 1000

        </script>
    </head>
    <body>
    
        <table>
            <tr><th>Total Users</th><td><span class="users"></span></td></tr>
            <tr><th>Queue</th><td><span class="queue"></span> ~<span class="newentry"></span></td></tr>
            <tr><th>Rate Limit</th><td><span class="remaining"></span> / <span class="limit"></span></td></tr>
        </table>
        
        <input id="newuser" type="text" size="30" />
        <a class="newuser" href="#">Add User</a>
        
        <br /><br />
        
        <input id="finduser" type="text" size="30" />
        <a class="finduser" href="#">Find User</a>
        
        <ul id="userlist">
                
        </ul>
    
    </body>
</html>